# Alpine Package and Repository

This directory contains the Alpine Linux package build system for modbus2mqtt.

## Structure

```
alpine/
├── package/           # Alpine package sources
│   └── modbus2mqtt/  # Package build files
│       ├── APKBUILD                    # Alpine package build script
│       ├── package.sh                  # Containerized APK build script
│       ├── build-and-test-image.sh     # Build APK and test in Docker (legacy)
│       ├── Dockerfile.test             # Test Docker image
│       ├── modbus2mqtt.pre-install     # Pre-install script
│       ├── modbus2mqtt.post-install    # Post-install script
│       └── README.md                   # Package documentation
└── repo/             # Built packages (generated by package.sh)
    └── <arch>/       # Architecture-specific packages
        └── *.apk     # Built APK packages
```

## Building the Package

### Prerequisites

- Docker
- Environment variable:
  - `PACKAGER_PRIVKEY` - Private abuild key (public key is derived automatically)

### Build Commands

```bash
cd alpine/package/modbus2mqtt

# Build the package
./package.sh

# Build and test in Docker
./build-and-test-image.sh
```

The built packages will be placed in `alpine/repo/<arch>/`.

## Using the Repository

Add the repository to your Alpine system:

```bash
# Copy the public key
sudo cp alpine/repo/<arch>/builder-*.rsa.pub /etc/apk/keys/

# Add repository to apk
echo "/path/to/alpine/repo/<arch>" | sudo tee -a /etc/apk/repositories

# Update and install
sudo apk update
sudo apk add modbus2mqtt
```

## Notes

- The `repo/` directory is generated during build and should not be committed to git
- The `build/` and `work/` directories in the package are temporary build artifacts
- All build processes run in Docker containers for reproducibility
