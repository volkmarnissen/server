#!/bin/sh

# Pre-commit hook to run prettier on staged files
# This hook is managed in the repository under .githooks/
# To enable it, run: git config core.hooksPath .githooks

echo "Running prettier on staged files..."

# Get list of staged files (only added or modified)
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|css|html)$')

if [ -z "$STAGED_FILES" ]; then
  echo "No relevant files to format"
  exit 0
fi

# Run prettier on staged files
echo "$STAGED_FILES" | xargs npm run prettier --

# Check if prettier made any changes
CHANGED_FILES=$(git diff --name-only)

if [ -n "$CHANGED_FILES" ]; then
  echo ""
  echo "Prettier formatted the following files:"
  echo "$CHANGED_FILES"
  echo ""
  echo "Please review the changes and stage them before committing again."
  echo "Run: git add . && git commit"
  exit 1
fi

echo "All files are properly formatted âœ“"
exit 0
